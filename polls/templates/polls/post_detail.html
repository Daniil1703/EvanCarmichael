{% extends 'polls/base.html' %}
{% load static %}

{% block title_block %}
    {{ post.title }}
{% endblock %}

{% block links %}
    <link rel="stylesheet" href="{% static 'css/post_detail.css' %}">
    <link rel="stylesheet" href="{% static 'css/comments.css' %}">
    <script src="{% static 'js/ajax_for_favorites.js' %}"></script>
{% endblock %}

{% block content %}
<style media="screen">
    .add-to-favorites {
        background-repeat: no-repeat;
        background-image: url("{% static 'images/icons/star.png' %}");
    }
    .add-to-favorites.added {
        background-repeat: no-repeat;
        background-image: url("{% static 'images/icons/pointed-star.png' %}");
    }
</style>
<div class="post-detail-block">
    <div class="post_structure">
        <div class="title_post_detail">
            <h1 class="title-h1">
                {{ post.title }}
            </h1>
        </div>
        <div class="category_datePub">
            <p>
                <img src="https://img.icons8.com/cotton/64/000000/time.png" width="25"/>{{ post.date_pub|date:"j E Y"}}
            </p>
        </div>

        <div class="share_link_for_post">
            <!— AddToAny BEGIN —>
            <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
                <a class="a2a_button_copy_link"></a>
                <a class="a2a_button_vk"></a>
                <a class="a2a_button_facebook"></a>
                <a class="a2a_button_twitter"></a>
                <a class="a2a_button_email"></a>
                <a class="a2a_button_telegram"></a>
                <a class="a2a_button_odnoklassniki"></a>
                <div class="star">
                    {% include 'favorites/includes/add_to_favorites.html' with type="post" id=post.id %}
                </div>
            </div>
            <script async src="https://static.addtoany.com/menu/page.js"></script>
            <!— AddToAny END —>
        </div>
        <hr>
        <div class="body_of_post">
            {% autoescape off %}
                <span>{{ post.body }}</span>
            {% endautoescape %}
        </div>
        <hr>
        <div class="tags-post-detail">
            {% for tag in post.tags.all %}
            <a href="{% url 'polls:tag_detail' slug=tag.slug %}">
                {{ tag.title }}
            </a>
            {% endfor %}
        </div>
        <hr>
<!--------------------------------- КОММЕНТАРИИ К СТАТЬЯМ------------------------------ -->
        <h2>{{ comment.count }} Комментариев</h2>
        <hr>
        {% for comments in comment %}
            <div class="comment-block">
                {% if not comments.parent_comment %}
                    <div class="box-comment">
                        <div class="comment-avatar"><img width="70" src="{% static 'images/icons/noava.png' %}" alt="ew"></div>
                        <div class="comment-data">
                            <h4>{{ comments.author.login_user }}</h4>
                            <p class="comment-body">{{ comments.body }}</p>
                            <p>{{ comments.created_time }} |
                                {% if request.user.is_authenticated %}
                                    <a href="#">Ответить</a>
                                {% else %}
                                    <a href="{% url 'users:login' %}">Ответить</a>
                                {% endif %}
                            </p>
                            <hr>
                        </div>
                    </div>
                    {% for parent_comment_id in comments.replies.all %}
                        <div class="box-comment">
                            <div style="margin-left: 50px;" class="comment-avatar"><img width="50" src="{% static 'images/icons/noava.png' %}" alt="ew"></div>
                            <div class="comment-data">
                                <h4>{{ parent_comment_id.author.login_user }}</h4>
                                <p class="comment-body-tree">{{ parent_comment_id.body }}</p>
                                <p>
                                    {{ parent_comment_id.created_time }}
                                </p>
                                <hr>
                            </div>
                        </div>
                    {% endfor %}
                    {% if request.user.is_authenticated %}
                        <div class="comment-input-block-replie">
                            <form action="{% url 'polls:post_detail_url' slug=post.slug%}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="comments_id" value="{{ comments.id }}">
                                {{ form_class.as_p }}
                                <button class="but_comment" type="submit" name="button">Ответить</button>
                            </form>
                        </div>
                    {% endif %}
                {% endif %}
            </div>
        {% endfor %}

        {% if request.user.is_authenticated %}
            <form class="comment-input-block" action="{% url 'polls:post_detail_url' slug=post.slug%}" method="post">
                {% csrf_token %}
                    {{ form_class.as_p }}
                    <button class="but_comment" type="submit" name="button">Оставить комментарий</button>
            </form>
        {% else %}
            <div class="login-for-comments">
                <hr>
                <h5>
                    <a class="auth-for-comment" href="{% url 'users:login' %}">Войдите</a>
                     в систему или
                     <a class="auth-for-comment" href="{% url 'users:user_create_url' %}">зарегистрируйтесь</a>,
                     чтобы оставить комментарии
                 </h5>
            </div>
        {% endif %}
    </div>
    <!-- <div class="ads-post-detail">

    </div> -->
</div>
{% endblock %}
